----------------------
-- FACILITY f√ºr PWC --
----------------------
-- CI START FOR ALL TAPES
-- Drop View
drop view AMC.TAPE_FACILITY_PWC;
-- View erstellen
create or replace view AMC.TAPE_FACILITY_PWC as
select FACILITY_ID as FACILITY_ID,
       SYSTEM_SATZART as SYSTEM,
       PRODUCT_GROUP as SYSTEM_PRODUKTGRUPPE,
       IS_PWC_FOCUS as FOKUSSYSTEM,
       IN_SPOT as GNI,
       IN_BW as SAP,
       CLIENT_TYPE as GNI_TYP, --?
       BRANCH_FACILITY as GNI_ZUORDNUNG, --?
       LEADING_FACILITY_ID as GNI_LEITKONTO, -- FOCS
       PARENT_FACILITY_ID as GNI_PARENTFACILITY,
       CORRESPONDING_LIMIT_ID as GNI_RAHMEN,
       CLIENT_ID as GNI_KUNDE,
       CLIENT_ID_LEADING as GNI_KUNDE_LEADING,
       CLIENT_NO_BW as SAP_KUNDE,
       CLIENT_NAME_ANONYMIZED as GNI_NAME,
       GROUP_ID as GNI_KONZERNID,
       GROUP_NAME as GNI_KONZERN,
       GVK_BUNDESBANKNUMMER as GNI_BUNDESBANKNR,
       CLIENT_COUNTRY_ALPHA2 as GNI_KUNDELAND,
       PORTFOLIO_CLIENT_PERSON_IWHS as GNI_KUBE_OE,
       KUSY as SAP_KUSY,
       CLIENT_NACE as GNI_NACE,
       SEGMENT as SAP_SEGMENT,
       PRODUCTTYPE_DETAIL as GNI_PRODUKTTYP,
       PRODUCT_BW as SAP_PRODUKT,
       PRODUCT_BW_TEXT as SAP_PRODUKTTEXT,
       CURRENCY as GNI_WAEHRUNG,
       CURRENCY_BW as SAP_WAEHRUNG,
       RATING_NUMERIC_FVC as GNI_FVC_RATING,
       RATING_BW as SAP_RATING,
       RATING_BW_LAST_YEAR as SAP_RATING_VJ,
       RATING_ID_KUNDE as GNI_KUNDERATING,
       RATING_ID_KUNDE_LAST_YEAR as GNI_KUNDERATING_VJ,
       PROBABILITY_OF_DEFAULT_RATE_ZEB as GNI_ZEB_PD,
       PROBABILITY_OF_DEFAULT_RATE_BW as SAP_PD,
       RATING_MODULE_ZEB as GNI_ZEB_RATINGMODUL,
       RATING_MODULE_BW as SAP_RATINGMODUL,
       RATING_MODULE_NAME_BW as SAP_MODULNAME,
       RATING_SUBMODULE_BW as SAP_SUBMODUL,
       RATING_MODULE_DESCRIPTION_BW as SAP_MODULBESCHREIBUNG,
       RATING_BW_TYPE as SAP_IRBA_KSA,
       RATING_MODULE_CLIENT as GNI_KUNDEMODUL,
       RATING_DATE_FVC as GNI_FVC_RATINGDATUM,
       DEFAULT_BW as SAP_AUSFALL,
       PRJ_IS_FINREP_FORBORNE as GNI_ZEB_FORBORNE,
       ROUND(LGD_DEFAULT_RATE_ZEB,2) as GNI_ZEB_LGD,
       ROUND(LGD_DEFAULT_RATE_BW,2) as SAP_LGD,
       CREDIT_CONVERSION_FACTOR_BW as SAP_CCF,
       ROUND(EAD_BW,2) as SAP_EAD,
       ROUND(EL_BW,2) as SAP_EL,
       OWN_SYNDICATE_QUOTA as GNI_KONSORTIALANTEIL,
       PRINCIPAL_TYPE as GNI_PRINCIPALTYP,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_SPOT,2) as GNI_PRINCIPAL,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_SPOT_LAST_YEAR,2) as GNI_PRINCIPAL_VJ,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_COMPENSATION,2) as GNI_PRINCIPAL_BEI_KOMPENSATION,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_AVAL,2) as GNI_PRINCIPALKONS,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_SPOT_RAW,2) as GNI_PRINCIPAL_RAW,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_SPOT_RAW_LAST_YEAR,2) as GNI_PRINCIPAL_RAW_VJ,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_SEGUE,2) as GNI_INANSPRUCHNAHME_UEBERGELEITET,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_BW,2) as SAP_INANSPRUCHNAHME,
       ROUND(PRINCIPAL_OUTSTANDING_EUR_BW_LAST_YEAR,2) as SAP_INANSPRUCHNAHME_VJ,
       ROUND(BLANKO_BW,2) as SAP_BLANKO,
       ROUND(OFFBALANCE_EUR,2) as GNI_OFFBALANCE,
       ROUND(FREIE_LINIE,2) as SAP_FREIELINIE,
       ROUND(FREIE_LINIE_LAST_YEAR,2) as SAP_FREIELINIE_VJ,
       ROUND(AUSZAHLUNGSPLICHT_EUR,2) as GNI_AUSZAHLUNGSPFLICHT,
       ROUND(AMORTIZATION_IN_ARREARS_EUR_SPOT,2) as GNI_TILGUNGSRUECKSTAND,
       ROUND(AMORTIZATION_IN_ARREARS_FOR_COMPENSATION,2) as GNI_TILGUNGSRUECKSTAND_BEI_KOMPENSATION,
       ROUND(AMORTIZATION_IN_ARREARS_EUR_SPOT_RAW,2) as GNI_TILGUNGSRUECKSTAND_RAW,
       ROUND(INTEREST_IN_ARREARS_EUR_SPOT,2) as GNI_ZINSRUECKSTAND,
       ROUND(INTEREST_IN_ARREARS_FOR_COMPENSATION,2) as GNI_ZINSRUECKSTAND_BEI_KOMPENSATION,
       ROUND(INTEREST_IN_ARREARS_EUR_SPOT_RAW,2) as GNI_ZINSRUECKSTAND_RAW,
       ROUND(FEES_IN_ARREARS_EUR_SPOT,2) as GNI_PROVISIONSRUECKSTAND,
       ROUND(FEES_IN_ARREARS_EUR_SPOT_RAW,2) as GNI_PROVISIONSRUECKSTAND_RAW,
       ROUND(STUECKZINSEN_BW,2) as SAP_STUECKZINSEN,
       RIVO_STAGE as GNI_RIVO_STAGE,
       ROUND(SAP_EWBTES,2) as SAP_EWBTES,
       ROUND(FAIR_VALUE_ADJUSTMENT_EUR,2) as GNI_FVA,
       DAYS_PAST_DUE_BW as GNI_DAYS_PAST_DUE,
       HEDGING_FLAG_BW as SAP_HEDGING_FLAG,
       IS_AVAL as AVAL,
       -- RIVO
       ROUND(SPECIFIC_PROVISION_AMOUNT_EUR,2) as ABIT_EWB_EUR,
       ROUND(SPECIFIC_PROVISION_AMOUNT_OC,2) as ABIT_EWB_OC,
       RISK_PROVISION_ABIT_EXCHANGE_RATE_EUR2OC as ABIT_FX_EWB,
       ROUND(LOAN_LOSS_PROVISION_AMOUNT_EUR,2) as ABIT_RST_EUR,
       ROUND(LOAN_LOSS_PROVISION_AMOUNT_OC,2) as ABIT_RST_OC,
       RISK_PROVISION_ABIT_EXCHANGE_RATE_EUR2OC as ABIT_FX_RST,
       ZEB_STAGE_ONBALANCE,
       ROUND(ZEB_EWB_EUR_ONBALANCE,2) as ZEB_EWB_EUR_ONBALANCE,
       ROUND(ZEB_EWB_OC_ONBALANCE,2) as ZEB_EWB_OC_ONBALANCE,
       RISK_PROVISION_ZEB_EXCHANGE_RATE_EUR2OC as ZEB_FX_EWB_ONBALANCE,
       ZEB_STAGE_OFFBALANCE,
       ROUND(ZEB_EWB_EUR_OFFBALANCE,2) as ZEB_EWB_EUR_OFFBALANCE,
       ROUND(ZEB_EWB_OC_OFFBALANCE,2) as ZEB_EWB_OC_OFFBALANCE,
       RISK_PROVISION_ZEB_EXCHANGE_RATE_EUR2OC as ZEB_FX_EWB_OFFBALANCE,
       ZEB_STAGE_ONBALANCE_LAST_YEAR as ZEB_STAGE_ONBALANCE_VJ,
       ROUND(ZEB_EWB_EUR_ONBALANCE_LAST_YEAR,2) as ZEB_EWB_EUR_ONBALANCE_VJ,
       ROUND(ZEB_EWB_OC_ONBALANCE_LAST_YEAR,2) as ZEB_EWB_OC_ONBALANCE_VJ,
       RISK_PROVISION_ZEB_EXCHANGE_RATE_EUR2OC_LAST_YEAR as ZEB_FX_EWB_ONBALANCE_VJ,
       ZEB_STAGE_OFFBALANCE_LAST_YEAR as ZEB_STAGE_OFFBALANCE_VJ,
       ROUND(ZEB_EWB_EUR_OFFBALANCE_LAST_YEAR,2) as ZEB_EWB_EUR_OFFBALANCE_VJ,
       ROUND(ZEB_EWB_OC_OFFBALANCE_LAST_YEAR,2) as ZEB_EWB_OC_OFFBALANCE_VJ,
       RISK_PROVISION_ZEB_EXCHANGE_RATE_EUR2OC_LAST_YEAR as ZEB_FX_EWB_OFFBALANCE_VJ,
       -- Defaults
       CUT_OFF_DATE,
       CREATED_USER,
       CREATED_TIMESTAMP
from AMC.TABLE_FACILITY_CURRENT
where CUT_OFF_DATE = DATA_CUT_OFF_DATE
;

grant select on AMC.TAPE_FACILITY_PWC to group NLB_MW_ADAP_S_GNI_TROOPER;
-- CI END FOR ALL TAPES